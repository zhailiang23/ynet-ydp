-- ----------------------------
-- 客户授信信息测试数据
-- 为所有20个客户创建授信记录
-- 10个零售客户（R10001-R10010）
-- 10个对公客户（C20001-C20010）
-- ----------------------------

-- ==================== 客户授信信息（主表）测试数据 ====================

-- 零售客户授信（个人消费贷款、个人经营贷款、个人住房贷款、信用卡）
INSERT INTO crm_customer_credit (
  customer_id, statistics_date, credit_agreement_no, credit_product_type, currency_code,
  credit_limit, used_limit, available_limit, usage_ratio,
  credit_start_date, credit_end_date, credit_type, credit_status,
  approve_date, approve_amount, interest_rate, guarantee_type, credit_purpose,
  manager_user_id, branch_id, creator, updater, tenant_id
) VALUES
-- R10001 张三 - 个人消费贷款
(1, '2025-10-23', 'RC001-2025-001', 'personal_consumption', 'CNY',
 100000.00, 50000.00, 50000.00, 50.00,
 '2025-01-10', '2026-01-10', 'single', 'effective',
 '2025-01-08', 100000.00, 6.5, 'credit', '个人消费',
 104, 102, '1', '1', 0),

-- R10002 李四 - 个人住房贷款
(2, '2025-10-23', 'RC002-2025-002', 'mortgage', 'CNY',
 2000000.00, 1500000.00, 500000.00, 75.00,
 '2024-06-15', '2044-06-15', 'single', 'effective',
 '2024-06-10', 2000000.00, 4.9, 'mortgage', '购买住房',
 104, 102, '1', '1', 0),

-- R10003 王五 - 个人经营贷款
(3, '2025-10-23', 'RC003-2025-003', 'personal_business', 'CNY',
 500000.00, 300000.00, 200000.00, 60.00,
 '2025-03-20', '2026-03-20', 'single', 'effective',
 '2025-03-15', 500000.00, 7.2, 'mortgage', '经营周转',
 105, 102, '1', '1', 0),

-- R10004 赵六 - 信用卡
(4, '2025-10-23', 'RC004-2025-004', 'credit_card', 'CNY',
 50000.00, 20000.00, 30000.00, 40.00,
 '2024-09-01', '2027-09-01', 'single', 'effective',
 '2024-08-25', 50000.00, 18.25, 'credit', '信用消费',
 104, 102, '1', '1', 0),

-- R10005 孙七 - 个人消费贷款 + 信用卡
(5, '2025-10-23', 'RC005-2025-005', 'personal_consumption', 'CNY',
 150000.00, 80000.00, 70000.00, 53.33,
 '2025-02-01', '2026-02-01', 'single', 'effective',
 '2025-01-28', 150000.00, 6.8, 'guarantee', '装修消费',
 105, 102, '1', '1', 0),

(5, '2025-10-23', 'RC005-2025-006', 'credit_card', 'CNY',
 80000.00, 30000.00, 50000.00, 37.50,
 '2024-11-10', '2027-11-10', 'single', 'effective',
 '2024-11-05', 80000.00, 18.25, 'credit', '信用消费',
 105, 102, '1', '1', 0),

-- R10006 周八 - 个人住房贷款
(6, '2025-10-23', 'RC006-2025-007', 'mortgage', 'CNY',
 1500000.00, 1200000.00, 300000.00, 80.00,
 '2023-05-20', '2043-05-20', 'single', 'effective',
 '2023-05-15', 1500000.00, 5.1, 'mortgage', '购买住房',
 104, 102, '1', '1', 0),

-- R10007 吴九 - 个人经营贷款
(7, '2025-10-23', 'RC007-2025-008', 'personal_business', 'CNY',
 800000.00, 600000.00, 200000.00, 75.00,
 '2024-12-10', '2025-12-10', 'single', 'effective',
 '2024-12-05', 800000.00, 7.5, 'mortgage', '扩大经营',
 105, 102, '1', '1', 0),

-- R10008 郑十 - 个人消费贷款
(8, '2025-10-23', 'RC008-2025-009', 'personal_consumption', 'CNY',
 200000.00, 100000.00, 100000.00, 50.00,
 '2025-04-15', '2026-04-15', 'single', 'effective',
 '2025-04-10', 200000.00, 6.2, 'pledge', '购车消费',
 104, 102, '1', '1', 0),

-- R10009 钱十一 - 信用卡
(9, '2025-10-23', 'RC009-2025-010', 'credit_card', 'CNY',
 100000.00, 50000.00, 50000.00, 50.00,
 '2024-07-01', '2027-07-01', 'single', 'effective',
 '2024-06-25', 100000.00, 18.25, 'credit', '信用消费',
 105, 102, '1', '1', 0),

-- R10010 冯十二 - 个人住房贷款
(10, '2025-10-23', 'RC010-2025-011', 'mortgage', 'CNY',
 3000000.00, 2500000.00, 500000.00, 83.33,
 '2024-03-10', '2044-03-10', 'single', 'effective',
 '2024-03-05', 3000000.00, 4.75, 'mortgage', '购买住房',
 104, 102, '1', '1', 0);

-- 对公客户授信（综合授信、流动资金贷款、固定资产贷款、贸易融资等）
INSERT INTO crm_customer_credit (
  customer_id, statistics_date, credit_agreement_no, credit_product_type, currency_code,
  credit_limit, used_limit, available_limit, usage_ratio,
  credit_start_date, credit_end_date, credit_type, credit_status,
  approve_date, approve_amount, interest_rate, guarantee_type, credit_purpose,
  manager_user_id, branch_id, creator, updater, tenant_id
) VALUES
-- C20001 北京科技有限公司 - 综合授信
(11, '2025-10-23', 'CC001-2025-001', 'working_capital', 'CNY',
 10000000.00, 6000000.00, 4000000.00, 60.00,
 '2025-01-15', '2026-01-15', 'comprehensive', 'effective',
 '2025-01-10', 10000000.00, 5.6, 'mortgage', '流动资金周转',
 106, 103, '1', '1', 0),

-- C20002 上海贸易股份有限公司 - 贸易融资
(12, '2025-10-23', 'CC002-2025-002', 'trade_finance', 'CNY',
 15000000.00, 10000000.00, 5000000.00, 66.67,
 '2024-11-01', '2025-11-01', 'comprehensive', 'effective',
 '2024-10-25', 15000000.00, 5.2, 'guarantee', '进出口贸易融资',
 107, 103, '1', '1', 0),

-- C20003 深圳制造有限公司 - 固定资产贷款
(13, '2025-10-23', 'CC003-2025-003', 'fixed_asset', 'CNY',
 20000000.00, 15000000.00, 5000000.00, 75.00,
 '2024-07-20', '2029-07-20', 'single', 'effective',
 '2024-07-15', 20000000.00, 4.9, 'mortgage', '生产设备购置',
 106, 103, '1', '1', 0),

-- C20004 杭州电商有限公司 - 流动资金贷款
(14, '2025-10-23', 'CC004-2025-004', 'working_capital', 'CNY',
 8000000.00, 5000000.00, 3000000.00, 62.50,
 '2025-02-10', '2026-02-10', 'comprehensive', 'effective',
 '2025-02-05', 8000000.00, 5.8, 'pledge', '业务扩展资金',
 107, 103, '1', '1', 0),

-- C20005 南京建筑工程有限公司 - 项目贷款
(15, '2025-10-23', 'CC005-2025-005', 'project', 'CNY',
 30000000.00, 20000000.00, 10000000.00, 66.67,
 '2024-09-15', '2027-09-15', 'single', 'effective',
 '2024-09-10', 30000000.00, 5.5, 'mortgage', '基建项目融资',
 106, 103, '1', '1', 0),

-- C20006 成都餐饮管理有限公司 - 流动资金贷款
(16, '2025-10-23', 'CC006-2025-006', 'working_capital', 'CNY',
 5000000.00, 3000000.00, 2000000.00, 60.00,
 '2025-03-01', '2026-03-01', 'single', 'effective',
 '2025-02-25', 5000000.00, 6.2, 'guarantee', '连锁门店扩张',
 107, 103, '1', '1', 0),

-- C20007 武汉物流有限公司 - 流动资金贷款 + 票据融资
(17, '2025-10-23', 'CC007-2025-007', 'working_capital', 'CNY',
 12000000.00, 8000000.00, 4000000.00, 66.67,
 '2024-12-20', '2025-12-20', 'comprehensive', 'effective',
 '2024-12-15', 12000000.00, 5.4, 'mortgage', '物流业务周转',
 106, 103, '1', '1', 0),

(17, '2025-10-23', 'CC007-2025-008', 'bill_finance', 'CNY',
 3000000.00, 2000000.00, 1000000.00, 66.67,
 '2025-01-10', '2025-07-10', 'single', 'effective',
 '2025-01-05', 3000000.00, 4.8, 'credit', '票据融资',
 106, 103, '1', '1', 0),

-- C20008 广州医疗器械有限公司 - 固定资产贷款
(18, '2025-10-23', 'CC008-2025-009', 'fixed_asset', 'CNY',
 18000000.00, 12000000.00, 6000000.00, 66.67,
 '2024-08-01', '2029-08-01', 'single', 'effective',
 '2024-07-25', 18000000.00, 5.0, 'mortgage', '医疗设备采购',
 107, 103, '1', '1', 0),

-- C20009 西安软件开发有限公司 - 流动资金贷款
(19, '2025-10-23', 'CC009-2025-010', 'working_capital', 'CNY',
 6000000.00, 4000000.00, 2000000.00, 66.67,
 '2025-04-01', '2026-04-01', 'comprehensive', 'effective',
 '2025-03-25', 6000000.00, 5.9, 'credit', '研发资金支持',
 106, 103, '1', '1', 0),

-- C20010 长沙制造业有限公司 - 综合授信
(20, '2025-10-23', 'CC010-2025-011', 'working_capital', 'CNY',
 25000000.00, 18000000.00, 7000000.00, 72.00,
 '2024-10-15', '2025-10-15', 'comprehensive', 'effective',
 '2024-10-10', 25000000.00, 5.3, 'combined', '生产经营综合授信',
 107, 103, '1', '1', 0);

-- ==================== 客户授信使用明细（子表）测试数据 ====================

-- 为部分授信记录创建使用明细
INSERT INTO crm_customer_credit_detail (
  credit_id, customer_id, loan_no, contract_no, loan_date, mature_date,
  loan_amount, balance, interest_rate, loan_status, product_name, product_code,
  creator, updater, tenant_id
) VALUES
-- 张三的个人消费贷款明细
(1, 1, 'LN001-2025-001', 'CT001-2025-001', '2025-01-15', '2026-01-15',
 50000.00, 40000.00, 6.5, 'normal', '个人消费贷', 'PC001',
 '1', '1', 0),

-- 李四的个人住房贷款明细
(2, 2, 'LN002-2024-001', 'CT002-2024-001', '2024-06-20', '2044-06-20',
 2000000.00, 1850000.00, 4.9, 'normal', '个人住房按揭贷款', 'MG001',
 '1', '1', 0),

-- 王五的个人经营贷款明细
(3, 3, 'LN003-2025-001', 'CT003-2025-001', '2025-03-25', '2026-03-25',
 300000.00, 250000.00, 7.2, 'normal', '个人经营贷款', 'PB001',
 '1', '1', 0),

-- 周八的个人住房贷款明细
(7, 6, 'LN006-2023-001', 'CT006-2023-001', '2023-05-25', '2043-05-25',
 1500000.00, 1350000.00, 5.1, 'normal', '个人住房按揭贷款', 'MG001',
 '1', '1', 0),

-- 吴九的个人经营贷款明细
(8, 7, 'LN007-2024-001', 'CT007-2024-001', '2024-12-15', '2025-12-15',
 600000.00, 550000.00, 7.5, 'normal', '个人经营贷款', 'PB001',
 '1', '1', 0),

-- 郑十的个人消费贷款明细
(9, 8, 'LN008-2025-001', 'CT008-2025-001', '2025-04-20', '2026-04-20',
 100000.00, 90000.00, 6.2, 'normal', '个人汽车消费贷', 'PC002',
 '1', '1', 0),

-- 冯十二的个人住房贷款明细
(11, 10, 'LN010-2024-001', 'CT010-2024-001', '2024-03-15', '2044-03-15',
 3000000.00, 2800000.00, 4.75, 'normal', '个人住房按揭贷款', 'MG001',
 '1', '1', 0),

-- 北京科技有限公司流动资金贷款明细
(12, 11, 'LN011-2025-001', 'CT011-2025-001', '2025-01-20', '2026-01-20',
 3000000.00, 2800000.00, 5.6, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

(12, 11, 'LN011-2025-002', 'CT011-2025-002', '2025-02-15', '2026-02-15',
 3000000.00, 2900000.00, 5.6, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

-- 上海贸易股份有限公司贸易融资明细
(13, 12, 'LN012-2024-001', 'CT012-2024-001', '2024-11-10', '2025-05-10',
 5000000.00, 4800000.00, 5.2, 'normal', '进口贸易融资', 'TF001',
 '1', '1', 0),

(13, 12, 'LN012-2025-001', 'CT012-2025-001', '2025-02-20', '2025-08-20',
 5000000.00, 5000000.00, 5.2, 'normal', '出口贸易融资', 'TF002',
 '1', '1', 0),

-- 深圳制造有限公司固定资产贷款明细
(14, 13, 'LN013-2024-001', 'CT013-2024-001', '2024-07-25', '2029-07-25',
 20000000.00, 18500000.00, 4.9, 'normal', '固定资产贷款', 'FA001',
 '1', '1', 0),

-- 杭州电商有限公司流动资金贷款明细
(15, 14, 'LN014-2025-001', 'CT014-2025-001', '2025-02-15', '2026-02-15',
 5000000.00, 4700000.00, 5.8, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

-- 南京建筑工程有限公司项目贷款明细
(16, 15, 'LN015-2024-001', 'CT015-2024-001', '2024-09-20', '2027-09-20',
 20000000.00, 19000000.00, 5.5, 'normal', '工程项目贷款', 'PJ001',
 '1', '1', 0),

-- 成都餐饮管理有限公司流动资金贷款明细
(17, 16, 'LN016-2025-001', 'CT016-2025-001', '2025-03-05', '2026-03-05',
 3000000.00, 2800000.00, 6.2, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

-- 武汉物流有限公司流动资金贷款明细
(18, 17, 'LN017-2024-001', 'CT017-2024-001', '2024-12-25', '2025-12-25',
 4000000.00, 3800000.00, 5.4, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

(18, 17, 'LN017-2025-001', 'CT017-2025-001', '2025-01-20', '2025-12-25',
 4000000.00, 3900000.00, 5.4, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

-- 武汉物流有限公司票据融资明细
(19, 17, 'LN017-2025-002', 'CT017-2025-002', '2025-01-15', '2025-07-15',
 2000000.00, 2000000.00, 4.8, 'normal', '票据融资', 'BF001',
 '1', '1', 0),

-- 广州医疗器械有限公司固定资产贷款明细
(20, 18, 'LN018-2024-001', 'CT018-2024-001', '2024-08-05', '2029-08-05',
 18000000.00, 16800000.00, 5.0, 'normal', '固定资产贷款', 'FA001',
 '1', '1', 0),

-- 西安软件开发有限公司流动资金贷款明细
(21, 19, 'LN019-2025-001', 'CT019-2025-001', '2025-04-05', '2026-04-05',
 4000000.00, 3800000.00, 5.9, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

-- 长沙制造业有限公司流动资金贷款明细
(22, 20, 'LN020-2024-001', 'CT020-2024-001', '2024-10-20', '2025-10-20',
 10000000.00, 9500000.00, 5.3, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0),

(22, 20, 'LN020-2025-001', 'CT020-2025-001', '2025-01-15', '2025-10-20',
 8000000.00, 7800000.00, 5.3, 'normal', '流动资金贷款', 'WC001',
 '1', '1', 0);

-- ==================== 验证数据 ====================

-- 1. 统计各客户类型的授信记录数
SELECT
  c.customer_type,
  CASE c.customer_type WHEN 1 THEN '零售客户' WHEN 2 THEN '对公客户' END AS 客户类型,
  COUNT(DISTINCT cr.customer_id) AS 授信客户数,
  COUNT(cr.id) AS 授信记录数,
  SUM(cr.credit_limit) AS 授信总额度,
  SUM(cr.used_limit) AS 已用总额度,
  SUM(cr.available_limit) AS 可用总额度
FROM crm_customer_credit cr
JOIN crm_customer c ON cr.customer_id = c.id
WHERE cr.deleted = 0
GROUP BY c.customer_type;

-- 2. 统计各授信品种的分布
SELECT
  d.label AS 授信品种,
  COUNT(*) AS 记录数,
  SUM(cr.credit_limit) AS 授信总额度,
  SUM(cr.used_limit) AS 已用总额度,
  AVG(cr.usage_ratio) AS 平均使用比例
FROM crm_customer_credit cr
JOIN system_dict_data d ON cr.credit_product_type = d.value AND d.dict_type = 'aicrm_credit_product_type'
WHERE cr.deleted = 0
GROUP BY cr.credit_product_type, d.label
ORDER BY 记录数 DESC;

-- 3. 统计授信使用明细
SELECT
  c.customer_name AS 客户名称,
  cr.credit_agreement_no AS 授信协议号,
  COUNT(cd.id) AS 用信笔数,
  SUM(cd.loan_amount) AS 贷款总额,
  SUM(cd.balance) AS 贷款余额
FROM crm_customer_credit_detail cd
JOIN crm_customer_credit cr ON cd.credit_id = cr.id
JOIN crm_customer c ON cd.customer_id = c.id
WHERE cd.deleted = 0
GROUP BY cd.credit_id, c.customer_name, cr.credit_agreement_no
ORDER BY cd.credit_id;

-- 4. 查询授信状态分布
SELECT
  d.label AS 授信状态,
  COUNT(*) AS 记录数
FROM crm_customer_credit cr
JOIN system_dict_data d ON cr.credit_status = d.value AND d.dict_type = 'aicrm_credit_status'
WHERE cr.deleted = 0
GROUP BY cr.credit_status, d.label;

-- 5. 查询担保方式分布
SELECT
  d.label AS 担保方式,
  COUNT(*) AS 记录数,
  SUM(cr.credit_limit) AS 授信总额度
FROM crm_customer_credit cr
JOIN system_dict_data d ON cr.guarantee_type = d.value AND d.dict_type = 'aicrm_guarantee_type'
WHERE cr.deleted = 0
GROUP BY cr.guarantee_type, d.label
ORDER BY 记录数 DESC;

-- 6. 查询使用比例最高的前10个授信
SELECT
  c.customer_name AS 客户名称,
  cr.credit_agreement_no AS 授信协议号,
  d.label AS 授信品种,
  cr.credit_limit AS 授信额度,
  cr.used_limit AS 已用额度,
  cr.usage_ratio AS 使用比例
FROM crm_customer_credit cr
JOIN crm_customer c ON cr.customer_id = c.id
JOIN system_dict_data d ON cr.credit_product_type = d.value AND d.dict_type = 'aicrm_credit_product_type'
WHERE cr.deleted = 0
ORDER BY cr.usage_ratio DESC
LIMIT 10;
