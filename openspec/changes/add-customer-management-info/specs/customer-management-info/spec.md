# Customer Management Info Specification

## ADDED Requirements

### Requirement: 客户管理信息展示

系统 SHALL 在零售客户和对公客户的详情页面中提供"管理信息"页面,用于展示客户的归属管户关系和归属调整历史。

#### Scenario: 访问管理信息页面
- **WHEN** 用户在客户详情页面点击"管理信息"菜单项
- **THEN** 系统应显示管理信息页面,包含两个 Tab: "归属管户关系" 和 "归属调整历史"
- **AND** 默认展示"归属管户关系" Tab

#### Scenario: 空数据状态
- **WHEN** 客户没有任何归属关系或调整历史记录
- **THEN** 系统应显示友好的空数据提示信息
- **AND** 不应显示加载错误

### Requirement: 归属管户关系列表

系统 SHALL 在"归属管户关系" Tab 中以表格形式展示客户的所有归属关系记录,支持分页和刷新功能。

#### Scenario: 加载归属关系列表
- **WHEN** 用户切换到"归属管户关系" Tab
- **THEN** 系统应调用 `/aicrm/customer-assignment/page` API
- **AND** 传递当前客户 ID 作为查询条件
- **AND** 在表格中展示归属关系记录

#### Scenario: 展示归属关系字段
- **WHEN** 系统加载到归属关系数据
- **THEN** 表格应包含以下列:
  - 序号 (自动生成)
  - 归属类型 (1=主办, 2=协办, 使用字典转换)
  - 归属部门 (部门名称)
  - 客户经理 (用户名称)
  - 查看权限 (是/否)
  - 维护权限 (是/否)
  - 分配日期
  - 生效日期
  - 失效日期
  - 归属状态 (0=已失效, 1=生效中, 2=待生效, 使用字典转换)
  - 备注

#### Scenario: 归属类型字典转换
- **WHEN** 系统展示归属类型字段
- **THEN** 应使用字典数据将数字值转换为可读文本
- **AND** 1 应显示为"主办"
- **AND** 2 应显示为"协办"

#### Scenario: 归属状态字典转换
- **WHEN** 系统展示归属状态字段
- **THEN** 应使用字典数据将数字值转换为可读文本
- **AND** 0 应显示为"已失效"
- **AND** 1 应显示为"生效中"
- **AND** 2 应显示为"待生效"

#### Scenario: 布尔值字段格式化
- **WHEN** 系统展示查看权限或维护权限字段
- **THEN** true 应显示为"是"
- **AND** false 应显示为"否"
- **AND** null/undefined 应显示为"-"

#### Scenario: 刷新归属关系列表
- **WHEN** 用户点击表格工具栏的刷新按钮
- **THEN** 系统应重新加载当前页的数据
- **AND** 保持当前的分页状态

### Requirement: 归属调整历史列表

系统 SHALL 在"归属调整历史" Tab 中以表格形式展示客户归属关系的所有历史变更记录,支持分页和刷新功能。

#### Scenario: 加载调整历史列表
- **WHEN** 用户切换到"归属调整历史" Tab
- **THEN** 系统应调用 `/aicrm/customer-assignment-history/page` API
- **AND** 传递当前客户 ID 作为查询条件
- **AND** 在表格中展示调整历史记录

#### Scenario: 展示调整历史字段
- **WHEN** 系统加载到调整历史数据
- **THEN** 表格应包含以下列:
  - 序号 (自动生成)
  - 调整日期
  - 调整级别 (使用字典 aicrm_transfer_level 转换)
  - 调整原因
  - 调整前归属类型 (1=主办, 2=协办)
  - 调整前部门 (部门名称)
  - 调整前客户经理 (用户名称)
  - 调整后归属类型 (1=主办, 2=协办)
  - 调整后部门 (部门名称)
  - 调整后客户经理 (用户名称)
  - 分配日期
  - 备注

#### Scenario: 调整级别字典转换
- **WHEN** 系统展示调整级别字段
- **THEN** 应使用字典 aicrm_transfer_level 转换为可读文本
- **AND** 如果字典值不存在,应显示原始值
- **AND** null/undefined 应显示为"-"

#### Scenario: 调整前后对比展示
- **WHEN** 系统展示调整历史记录
- **THEN** 应清晰区分调整前和调整后的信息
- **AND** 调整前字段应添加"调整前"前缀
- **AND** 调整后字段应添加"调整后"前缀

#### Scenario: 刷新调整历史列表
- **WHEN** 用户点击表格工具栏的刷新按钮
- **THEN** 系统应重新加载当前页的数据
- **AND** 保持当前的分页状态

### Requirement: 样式一致性

系统 SHALL 确保管理信息页面的样式与客户家庭信息页面保持一致。

#### Scenario: Tab 样式一致性
- **WHEN** 用户查看管理信息页面
- **THEN** Tab 标签的样式应与家庭信息页面的 Tab 样式一致
- **AND** 激活的 Tab 应有明显的视觉区分
- **AND** Tab 之间应没有额外的边框

#### Scenario: 表格样式一致性
- **WHEN** 系统展示归属关系或调整历史表格
- **THEN** 表格的样式应与项目中其他 VxeTable 保持一致
- **AND** 表头、行高、字体大小应统一
- **AND** 鼠标悬停时行应高亮显示

#### Scenario: 响应式布局
- **WHEN** 用户在不同尺寸的屏幕上查看管理信息页面
- **THEN** 页面应正确适配屏幕尺寸
- **AND** 表格应支持横向滚动以显示所有列
- **AND** Tab 切换功能应在移动端正常工作

### Requirement: 错误处理

系统 SHALL 妥善处理数据加载失败的情况,并向用户提供友好的错误提示。

#### Scenario: API 调用失败
- **WHEN** 后端 API 调用失败 (网络错误、服务器错误等)
- **THEN** 系统应显示错误消息提示
- **AND** 错误消息应清晰描述问题
- **AND** 用户应能够通过刷新按钮重试

#### Scenario: 数据解析错误
- **WHEN** 后端返回的数据格式不符合预期
- **THEN** 系统应捕获异常并显示友好的错误提示
- **AND** 不应导致页面崩溃
- **AND** 错误信息应记录到控制台以便调试

### Requirement: 性能优化

系统 SHALL 优化数据加载和渲染性能,确保页面响应流畅。

#### Scenario: 懒加载数据
- **WHEN** 用户首次打开管理信息页面
- **THEN** 系统应仅加载当前激活 Tab 的数据
- **AND** 切换到其他 Tab 时才加载对应的数据

#### Scenario: 分页加载
- **WHEN** 客户有大量归属关系或调整历史记录
- **THEN** 系统应使用分页机制限制单次加载的数据量
- **AND** 默认每页显示 20 条记录
- **AND** 用户可以通过分页控件浏览其他页的数据

#### Scenario: 缓存优化
- **WHEN** 用户在同一会话中多次查看同一客户的管理信息
- **THEN** 系统 MAY 缓存已加载的数据
- **AND** 用户可以通过刷新按钮强制重新加载最新数据
